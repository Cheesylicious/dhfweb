<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Schichtplan - DHF-Planer</title>
    <meta name="viewport" content="width=1200">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        /* Import einer modernen Schriftart */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background: #1a1a1a; /* DUNKLER HINTERGRUND (BLEIBT) */
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Das Canvas-Element f√ºr die Animation (BLEIBT) */
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Header (Glas-Effekt) (BLEIBT) */
        header {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 { margin: 0; color: #ffffff; font-size: 24px; }
        header nav { display: flex; gap: 20px; align-items: center; }
        header nav a {
            text-decoration: none; color: #bdc3c7; font-weight: 500; font-size: 16px;
            padding: 10px; border-radius: 5px; transition: background-color 0.3s, color 0.3s;
            display: inline-flex;
            align-items: center;
        }
        header nav a.active, header nav a:hover {
            background-color: rgba(255, 255, 255, 0.1); color: #ffffff;
        }
        #user-info { display: flex; align-items: center; gap: 15px; color: #bdc3c7; }
        #logout-btn {
            background: #e74c3c; color: white; padding: 10px 15px; border: none;
            border-radius: 5px; cursor: pointer; font-size: 15px; transition: background-color 0.3s;
        }
        #logout-btn:hover { background: #c0392b; }

        /* Feedback Button */
        .report-btn {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            transition: background-color 0.3s;
            margin-right: 15px;
        }
        .report-btn:hover {
            background: #2980b9;
        }

        .nav-badge {
            background: #e74c3c;
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 5px;
            border-radius: 5px;
            margin-left: 8px;
            display: none;
        }

        /* Main (Volle Breite) (BLEIBT) */
        main {
            padding: 30px;
            max-width: 100%;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }

        /* Card (ZUR√úCK ZU WEISS) */
        .card {
            background: #fff;
            color: #333;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        /* Sub-Nav (Glas-Effekt) */
        .sub-nav {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 0 30px;
            margin-bottom: 30px;
            margin-top: -1px;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 100000;
        }
        .sub-nav a {
            display: inline-block; padding: 15px 20px; text-decoration: none;
            color: #bdc3c7; font-weight: 500; border-bottom: 3px solid transparent;
            transition: color 0.3s;
        }
        .sub-nav a.active, .sub-nav a:hover {
            color: #ffffff;
            border-bottom-color: #3498db;
        }

        /* Dropdown-Men√º */
        .dropdown {
            position: relative;
            display: inline-block;
            z-index: 100001;
        }
        .dropdown .dropbtn {
            font-family: 'Poppins', sans-serif;
            text-decoration: none; color: #bdc3c7; font-weight: 500; font-size: 16px;
            padding: 15px 20px; background: none; border: none; cursor: pointer;
            border-bottom: 3px solid transparent; transition: color 0.3s;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 100002;
            border-radius: 5px;
            margin-top: 0px;
            left: 0;
        }
        .dropdown-content a {
            color: #bdc3c7;
            padding: 12px 16px; text-decoration: none; display: block;
            font-size: 15px; border-bottom: none; transition: background-color 0.3s, color 0.3s;
        }
        .dropdown-content a:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: #ffffff;
        }

        .dropdown:hover .dropdown-content { display: block; }
        .dropdown:hover .dropbtn, .dropbtn.active {
            color: #ffffff;
            border-bottom-color: #3498db;
        }
        .dropdown-content a.active {
            background-color: rgba(52, 152, 219, 0.2);
            font-weight: 600;
            color: #3498db;
        }

        /* --- Grid Styles --- */

        .plan-nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px;
            background-color: #fcfcfc;
            border-bottom: 1px solid #eee;
            /* --- NEU: Flex-Wrap f√ºr mobile Ansicht --- */
            flex-wrap: wrap;
            gap: 15px;
        }
        /* --- NEU: Monat/Jahr-Container --- */
        .plan-nav-month-year {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-grow: 1; /* Nimmt Platz ein */
        }
        .plan-nav h2 { margin: 0; font-size: 22px; color: #333; }

        .plan-nav button {
            padding: 8px 16px; font-size: 15px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            color: #333;
            border-radius: 5px; cursor: pointer;
            transition: background-color 0.3s;
        }
        .plan-nav button:hover {
            background: #e0e0e0;
        }

        /* --- NEU: Plan-Status Container --- */
        #plan-status-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 10px;
            background: #f4f4f4;
            border-radius: 6px;
        }
        #plan-status-badge {
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        /* Status-Farben */
        #plan-status-badge.status-in-bearbeitung {
            background-color: #fff3cd; /* Gelb */
            color: #856404;
        }
        #plan-status-badge.status-fertiggestellt {
            background-color: #d4edda; /* Gr√ºn */
            color: #155724;
        }

        /* Admin-Buttons im Status-Container */
        #plan-status-container .btn-admin-action {
            display: none; /* Standardm√§√üig versteckt */
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 500;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        /* Admin-Modus zeigt die Buttons */
        body.admin-mode #plan-status-container .btn-admin-action {
            display: inline-block;
        }

        /* Spezifische Button-Stile */
        #plan-lock-btn {
            background-color: #f8d7da; /* Hellrot */
            color: #721c24;
        }
        #plan-lock-btn.locked {
            background-color: #e74c3c; /* Kr√§ftiges Rot */
            color: white;
        }
        #plan-status-toggle-btn {
            background-color: #cce5ff; /* Hellblau */
            color: #004085;
        }
        /* --- ENDE NEU: Plan-Status --- */


        /* (Kein Speicher-Button in dieser Version) */
        #save-staffing-order-btn { display: none; }


        /* --- ANPASSUNG (Regel 1): Wrapper √ºbernimmt Scrollen --- */
        #unified-grid-wrapper {
            overflow-x: auto;
        }

        #schichtplan-grid-container {
            /* overflow-x: auto; */ /* <-- ENTFERNT */
        }
        #schichtplan-grid {
            display: grid;
        }
        /* --- ENDE ANPASSUNG --- */


        /* --- ANPASSUNG: "√ú"-Spalten hinzugef√ºgt --- */
        .grid-header, .grid-cell, .grid-user-name, .grid-user-total, .grid-user-dog, .grid-header-uebertrag, .grid-user-uebertrag {
            padding: 10px;
            border-bottom: 1px solid #eee;
            border-right: 1px solid #eee;
            text-align: center; font-size: 14px; line-height: 1.4;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
            color: #333;
        }

        .grid-header {
            background: #fcfcfc;
            font-weight: 600; position: sticky; top: 0;
            z-index: 100; /* Z-Index erh√∂ht, damit es √ºber der Tagesmarkierung liegt */
        }

        /* --- NEU: Schwarzer Trennstrich unter der zweiten Kopfzeile --- */
        .header-separator-bottom {
            border-bottom: 2px solid #000000 !important; /* Fetter schwarzer Strich */
        }
        /* --- ENDE NEU --- */

        .grid-header.weekend { background-color: var(--weekend-bg-color, #fff8f8); color: var(--weekend-text-color, #333); }
        .grid-cell.weekend { background-color: var(--weekend-bg-color, #fff8f8); color: var(--weekend-text-color, #333); }

        /* --- ANPASSUNG (Regel 1) --- */
        /* Feiertag (Holiday) f√§rbt die GESAMTE Spalte (Header + Zellen) */
        .day-color-holiday { background-color: var(--holiday-bg-color, #ffddaa) !important; color: var(--text-color, #333); }
        .grid-header.day-color-holiday { color: var(--text-color, #333); }

        /* Training/Schie√üen f√§rbt NUR den Header */
        .grid-header.day-color-training { background-color: var(--training-bg-color, #daffdb) !important; color: var(--text-color, #333); }
        .grid-header.day-color-shooting { background-color: var(--shooting-bg-color, #ffb0b0) !important; color: var(--text-color, #333); }
        /* --- ENDE ANPASSUNG --- */

        /* --- Hervorhebung f√ºr den aktuellen Tag (Spalte) --- */
        .current-day-highlight {
            /* Simuliert einen Rahmen links und rechts INNERHALB der Zelle mit box-shadow.
               Verwendet das Blau #3498db f√ºr Konsistenz. */
            box-shadow: inset 2px 0 0 0 #3498db, inset -2px 0 0 0 #3498db !important;

            /* KORREKTUR: KEIN !important bei background-color, damit Schichtfarben gewinnen! */
            background-color: rgba(52, 152, 219, 0.08);

            z-index: 10; /* √úber Standard-Zellen, aber unter Headern (z-index 100) */
        }
        /* Spezifisch f√ºr Header: Hier wollen wir die Farbe erzwingen */
        .grid-header.current-day-highlight {
            color: #3498db !important;
            background-color: #eaf2ff !important;
        }

        .grid-user-name {
            font-weight: 600; text-align: left;
            position: sticky; left: 0;
            background: #fcfcfc;
            z-index: 100; /* Z-Index erh√∂ht, damit es beim Scrollen sichtbar bleibt */
            border-left: 1px solid #eee;
        }

        /* --- KORREKTUR: Textausrichtung f√ºr Spalten-Header und Inhalt --- */
        .grid-user-dog { font-weight: 500; text-align: left; background: #fcfcfc; color: #555; }
        .grid-header-dog { font-weight: 600; background: #fcfcfc; text-align: center; } /* Zentriert 'Mitarbeiter' und 'Diensthund' Header */

        /* --- KORREKTUR: Keine Truncation f√ºr Mitarbeiter und Diensthund --- */
        .grid-user-name, .grid-user-dog, .grid-header-dog {
            white-space: nowrap; /* Behalten wir bei, damit max-content funktioniert */
            overflow: visible !important;
            text-overflow: clip !important;
        }
        /* --- ENDE KORREKTUR --- */

        /* --- NEU: Stile f√ºr "√ú"-Spalte --- */
        .grid-header-uebertrag {
            font-weight: 600;
            background: #ffe8cc; /* Orange-Hintergrund */
            color: #8c5a00; /* Dunklerer Text f√ºr Kontrast */
            position: sticky;
            top: 0;
            z-index: 100; /* Z-Index erh√∂ht */
            border-right: 1px solid #ffcc99;
        }
        .grid-user-uebertrag {
            font-weight: 500;
            text-align: center;
            background: #fff3e6; /* Helleres Orange */
            color: #333;
            box-shadow: inset 0px 1px 3px rgba(0, 0, 0, 0.1);
            border-right: 1px solid #ffcc99; /* Akzent-Rand */
        }
        /* --- ENDE NEU --- */

        .grid-user-total { font-weight: 600; background: #f8f9fa; text-align: center; }
        .grid-header-total { font-weight: 600; background: #f8f9fa; text-align: center; } /* Zentriert 'Std.' Header */

        .grid-cell {
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
            box-shadow: inset 0px 1px 3px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        body:not(.admin-mode) .grid-cell { cursor: default; }

        .grid-cell.hovered {
            background-color: #d6eaff !important;
            box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.3);
            transform: scale(1.05);
            z-index: 20;
        }

        body.visitor-mode .grid-cell {
            cursor: default;
        }

        /* --- NEU: Visuelles Feedback f√ºr gesperrten Plan --- */
        body.plan-locked .grid-cell {
            cursor: not-allowed !important;
            background-image: repeating-linear-gradient(
                -45deg,
                transparent,
                transparent 5px,
                rgba(0, 0, 0, 0.02) 5px,
                rgba(0, 0, 0, 0.02) 10px
            );
        }
        body.plan-locked .grid-cell:hover {
            transform: none;
            box-shadow: inset 0px 1px 3px rgba(0, 0, 0, 0.2);
        }
        /* --- ENDE NEU --- */


        .grid-cell.violation {
            box-shadow: inset 0 0 0 3px #e74c3c !important;
            border: 1px solid #e74c3c !important;
        }

        /* --- START: KORRIGIERTE LEGENDE (CSS-Grid) --- */
        .plan-legende {
            padding: 20px;
            display: grid;
            /* --- KORREKTUR 1: Auf 3 Spalten gesetzt, um vollen Platz zu nutzen --- */
            grid-template-columns: repeat(3, 1fr);
            gap: 25px; /* Abstand zwischen den Gruppen */
            background: #fcfcfc;
            color: #333;
            border-top: 1px solid #eee;
        }

        .legende-titel {
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #3498db; /* Blauer Akzent */
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-size: 15px;
        }
        .legende-items {
            display: flex;
            flex-direction: column; /* Items untereinander */
            gap: 8px; /* Kleinerer Abstand f√ºr Listen-Items */
        }
        .legende-item {
            display: flex;
            /* --- KORREKTUR 2: B√ºndig oben ausrichten statt zentriert --- */
            align-items: flex-start;
            gap: 8px;
        }
        .legende-color {
            width: 15px;
            height: 15px;
            border: 1px solid #ccc;
            border-radius: 3px;
            flex-shrink: 0; /* Verhindert Schrumpfen */
            /* --- NEU: Sorgt f√ºr korrekte Ausrichtung bei Umbruch --- */
            margin-top: 3px;
        }
        .legende-name {
            font-size: 14px;
            color: #333; /* Stellt sicher, dass Text lesbar ist */

            /* --- KORREKTUR 3: Textumbruch erzwingen --- */
            white-space: normal;
            word-break: break-word;
        }
        .legende-name strong {
            color: #000; /* Abk√ºrzung fetter */
        }
        /* --- ENDE: KORRIGIERTE LEGENDE --- */

        .modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            color: #333;
            margin: 15% auto; padding: 0; border: 1px solid #888;
            width: 80%; max-width: 450px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 25px; border-bottom: 1px solid #eee;
        }
        .modal-header h2 { margin: 0; font-size: 18px; color: #333; }
        .close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-body { padding: 25px; color: #333; }

        #shift-selection { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        #shift-selection button {
            padding: 12px; font-size: 15px; font-weight: 600;
            border: 1px solid #ccc;
            border-radius: 5px; cursor: pointer;
            background-color: #f9f9f9;
            color: #333;
        }
        #shift-selection button:hover {
            border-color: #007bff;
            background-color: #f0f5fa;
        }
        body.visitor-mode #shift-modal {
            display: none !important;
        }
        body.plan-locked #shift-modal {
            display: none !important;
        }

        /* --- STILE F√úR MINDESTBESETZUNG --- */

        #staffing-grid-container {
            border-top: 2px solid #3498db;
            padding-top: 5px;
            background: #fdfdfd;
        }

        /* Container ist jetzt Flex-Column f√ºr die Zeilen */
        #staffing-grid {
            display: flex;
            flex-direction: column;
        }

        /* Jede Zeile ist ein eigenes Grid */
        .staffing-row {
            display: grid;
            /* grid-template-columns wird inline per JS gesetzt */
            border-bottom: 1px solid #eee;
            background: #fff;
            /* WICHTIG: Textauswahl verhindern, wenn Sortiermodus an ist (via Klasse am Parent oder JS) */
        }

        /* Klasse, die via JS auf die staffing-row gesetzt werden kann, um Auswahl zu verhindern */
        .staffing-row.sort-mode-active {
            user-select: none;
            cursor: grab;
        }

        .staffing-header, .staffing-cell, .staffing-label, .staffing-total-header {
            padding: 8px 10px;
            text-align: center;
            font-size: 13px;
            line-height: 1.3;
            white-space: nowrap;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            border-right: 1px solid #eee; /* Vertikale Trennlinien */
        }
        .staffing-label {
            font-weight: 600;
            text-align: left;
            position: sticky;
            left: 0;
            background: #fcfcfc;
            z-index: 4;
            border-left: 1px solid #eee;
        }

        /* --- DRAG & DROP STYLES --- */

        /* Globales Verhindern von Textauswahl beim Draggen */
        body.dragging, body.dragging * {
            user-select: none !important;
            -webkit-user-select: none !important;
            cursor: grabbing !important;
        }

        .staffing-drag-handle {
            cursor: grab;
            color: #777;
            font-size: 18px;
            padding: 0 10px;
            font-weight: bold;
            display: inline-block;
            vertical-align: middle;
        }
        .staffing-drag-handle:hover {
            color: #3498db;
        }
        .staffing-drag-handle:active {
            cursor: grabbing;
        }

        /* KORRIGIERTES Styling f√ºr den "Ghost" (die Kopie beim Ziehen) */
        /* Wir nutzen display: grid, damit die Spalten erhalten bleiben */
        .sortable-fallback {
            display: grid !important; /* Zwingt Grid-Layout auf die Kopie */
            /* Breite und Spalten werden vom Original geerbt (inline styles) */
            background-color: #ffffff;
            border: 1px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            opacity: 1 !important;
            z-index: 9999;
            pointer-events: none; /* Wichtig: Klicks durchlassen */
        }

        /* Im Fallback wollen wir alle Zellen sehen, damit es wie die echte Zeile aussieht */
        .sortable-fallback .staffing-cell,
        .sortable-fallback .staffing-total-header,
        .sortable-fallback .staffing-label {
            display: block; /* Oder flex/grid item default */
        }

        /* Der Platzhalter (L√ºcke) */
        .sortable-ghost {
            opacity: 0.2;
            background: #3498db !important;
        }

        .staffing-total-header {
            position: sticky;
            top: auto;
            z-index: 1;
            background: #f8f9fa;
            font-weight: 600;
        }
        .staffing-header {
            background: #fcfcfc;
            font-weight: 600;
            position: sticky;
            top: auto;
            z-index: 1;
        }
        .staffing-cell {
            font-weight: 500;
            font-size: 14px;
        }
        .staffing-cell.weekend { background-color: var(--weekend-bg-color, #fff8f8); }
        .staffing-header.weekend { background-color: var(--weekend-bg-color, #fff8f8); }

        .staffing-ok {
            background-color: #d4edda !important;
            color: #155724;
            font-weight: 700;
        }
        .staffing-warning {
            background-color: #fff3cd !important;
            color: #856404;
            font-weight: 700;
        }
        .staffing-violation {
            background-color: #ffcccc !important;
            color: #c00000;
            font-weight: 700;
            box-shadow: inset 0 0 0 1px #e74c3c;
        }

        .staffing-untracked {
            background-color: #f8f9fa !important;
            color: #bbb;
        }

        /* --- ACTIONS UNTEN (Links ausgerichtet) --- */
        .staffing-actions {
            padding: 10px 20px;
            background: #fcfcfc;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Linksb√ºndig */
        }

        #staffing-sort-toggle {
            background: #3498db;
            color: white;
            border: none;
            margin-left: 0;
            transition: background 0.3s;
            padding: 8px 15px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 5px;
        }
        #staffing-sort-toggle:hover {
             background: #2980b9;
        }

        /* Eigener Benutzer */
        .grid-user-name.current-user-row {
            background-color: #eaf2ff !important;
            border-left: 2px solid #3498db;
        }
        .grid-user-dog.current-user-row { background-color: #f4f8ff !important; }
        .grid-user-uebertrag.current-user-row { background-color: #eaf2ff !important; }
        .grid-user-total.current-user-row {
            background-color: #eaf2ff !important;
            border-right: 2px solid #3498db;
        }
        .grid-user-name.current-user-row,
        .grid-user-dog.current-user-row,
        .grid-user-uebertrag.current-user-row,
        .grid-cell.current-user-row,
        .grid-user-total.current-user-row {
            border-top: 2px solid #3498db;
            border-bottom: 2px solid #3498db;
            padding-top: 8px; padding-bottom: 8px;
        }

    </style>
</head>
<body>

    <canvas id="particle-canvas"></canvas>

    <header>
        <h1>DHF-Planer</h1>
        <nav>
            <a href="dashboard.html" id="nav-dashboard" style="display: none;">Dashboard</a>
            <a href="users.html" id="nav-users" style="display: none;">Benutzerverwaltung</a>
            <a href="feedback.html" id="nav-feedback" style="display: none;">
                Meldungen
                <span id="feedback-badge" class="nav-badge">0</span>
            </a>
            <a href="schichtplan.html" class="active">Schichtplan</a>
        </nav>
        <div id="user-info">
            <span id="welcome-user"></span>
            <button class="report-btn" id="global-report-btn">üêû Problem melden</button>
            <button id="logout-btn">Abmelden</button>
        </div>
    </header>

    <div class="sub-nav">
        <a href="schichtplan.html" class="active">Schichtplan</a>
        <div class="dropdown" id="settings-dropdown">
            <button class="dropbtn">Einstellungen &raquo;</button>
            <div class="dropdown-content" id="settings-dropdown-content">
                <a href="einstellungen.html" class="admin-only">Mitarbeiter Sortierung</a>
                <a href="schichtarten.html" class="admin-only">Schichtarten</a>
                <a href="shortcuts.html" class="admin-only">Shortcuts</a>
                <a href="feiertage.html" class="admin-only">Feiertage & Sondertermine</a>
                <a href="farbeeinstellungen.html" class="admin-only">Farbeinstellungen</a> </div>
        </div>
    </div>

    <main>
        <div class="card">
            <div class="plan-nav">
                <button id="prev-month-btn">&laquo; Vorheriger</button>

                <div class="plan-nav-month-year">
                    <h2 id="current-month-label">Lade...</h2>

                    <div id="plan-status-container" style="display: none;">
                        <span id="plan-status-badge"></span>
                        <button id="plan-lock-btn" class="btn-admin-action" title="Plan sperren/entsperren"></button>
                        <button id="plan-status-toggle-btn" class="btn-admin-action" title="Status wechseln"></button>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button id="next-month-btn">N√§chster &raquo;</button>
                </div>
            </div>

            <div id="unified-grid-wrapper">

                <div id="schichtplan-grid-container">
                    <div id="schichtplan-grid">
                        </div>
                </div>

                <div id="staffing-grid-container">
                    <div id="staffing-grid">
                        </div>
                </div>

            </div>

            <div class="staffing-actions">
                <button class="btn-primary" id="staffing-sort-toggle">Besetzung sortieren</button>
            </div>

            <div class="plan-legende" id="plan-legende-container">
                <div class="legende-gruppe">
                    <div class="legende-titel">Arbeitsschichten</div>
                    <div class="legende-items" id="legende-arbeit">
                        </div>
                </div>
                <div class="legende-gruppe">
                    <div class="legende-titel">Abwesenheiten</div>
                    <div class="legende-items" id="legende-abwesenheit">
                        </div>
                </div>
                <div class="legende-gruppe">
                    <div class="legende-titel">Sonderdienste & Sonstiges</div>
                    <div class="legende-items" id="legende-sonstiges">
                        </div>
                </div>
            </div>
            </div>
    </main>

    <div id="shift-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="shift-modal-title">Schicht ausw√§hlen</h2>
                <span class="close" id="close-shift-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p id="shift-modal-info"></p>
                <div id="shift-selection"></div>
            </div>
        </div>
    </div>

    <script>
        // --- PARTIKEL-ANIMATION (Unver√§ndert) ---
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        const nodeColor = '#3498db';
        const lineColor = '#ecf0f1';
        let particlesArray;
        function setCanvasSize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        setCanvasSize();
        class Particle {
            constructor(x, y, directionX, directionY, size) { this.x = x; this.y = y; this.directionX = directionX; this.directionY = directionY; this.size = size; }
            draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false); ctx.fillStyle = nodeColor; ctx.fill(); }
            update() { if (this.x > canvas.width || this.x < 0) { this.directionX = -this.directionX; } if (this.y > canvas.height || this.y < 0) { this.directionY = -this.directionY; } this.x += this.directionX; this.y += this.directionY; this.draw(); }
        }
        function init() {
            particlesArray = []; let numberOfParticles = (canvas.height * canvas.width) / 9000; if (numberOfParticles > 100) numberOfParticles = 100;
            for (let i = 0; i < numberOfParticles; i++) {
                let size = (Math.random() * 2) + 1; let x = (Math.random() * ((canvas.width - size * 2) - (size * 2)) + size * 2);
                let y = (Math.random() * ((canvas.height - size * 2) - (size * 2)) + size * 2);
                let directionX = (Math.random() * 0.4) - 0.2; let directionY = (Math.random() * 0.4) - 0.2;
                particlesArray.push(new Particle(x, y, directionX, directionY, size));
            }
        }
        function connect() {
            let maxDistance = 150; ctx.strokeStyle = lineColor;
            for (let a = 0; a < particlesArray.length; a++) {
                for (let b = a; b < particlesArray.length; b++) {
                    let distance = ((particlesArray[a].x - particlesArray[b].x) * (particlesArray[a].x - particlesArray[b].x)) + ((particlesArray[a].y - particlesArray[b].y) * (particlesArray[a].y - particlesArray[b].y));
                    if (distance < (maxDistance * maxDistance)) { let opacity = 1 - (distance / (maxDistance * maxDistance)); ctx.globalAlpha = opacity; ctx.beginPath(); ctx.moveTo(particlesArray[a].x, particlesArray[a].y); ctx.lineTo(particlesArray[b].x, particlesArray[b].y); ctx.stroke(); }
                }
            }
            ctx.globalAlpha = 1.0;
        }
        function animate() { requestAnimationFrame(animate); ctx.clearRect(0, 0, canvas.width, canvas.height); for (let i = 0; i < particlesArray.length; i++) { particlesArray[i].update(); } connect(); }
        window.addEventListener('resize', () => { setCanvasSize(); init(); });
        init(); animate();
    </script>

    <script src="schichtplan.js" defer></script>

    <script src="shared_feedback.js" defer></script>
</body>
</html>